<!-- BookSearch BPEL Process [Generated by the Eclipse BPEL Designer]
-->
<bpel:process name="BookSearch"
              targetNamespace="http://bpelunit.net/test/bookSearch"
              suppressJoinFailure="yes"
              xmlns:tns="http://bpelunit.net/test/bookSearch"
              xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
              xmlns:ns1="http://bpelunit.net/test/bookSearchArtifacts"
              xmlns:ns="http://www.example.org/bookSearchWrapper/">

  <!-- ================================================================= -->
  <!-- PARTNERLINKS                                                      -->
  <!-- List of services participating in this BPEL process               -->
  <!-- =================================================================
  -->
  <bpel:import namespace="http://bpelunit.net/test/bookSearchArtifacts" location="BookSearchArtifacts.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
  <bpel:import namespace="http://www.example.org/bookSearchWrapper/" location="BookSearch.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
  <bpel:partnerLinks>
    <bpel:partnerLink name="client"
                      partnerLinkType="ns1:UnlimitedSearchPLT"
                      myRole="searchEngine"
                      xmlns:ns1="http://bpelunit.net/test/bookSearchArtifacts"/>
    <bpel:partnerLink name="helper"
                      partnerLinkType="ns1:LimitedSearchPLT"
                      partnerRole="searchEngine"
                      xmlns:ns1="http://bpelunit.net/test/bookSearchArtifacts"/>
  </bpel:partnerLinks>

  <!-- ================================================================= -->
  <!-- VARIABLES                                                         -->
  <!-- List of messages and XML documents used within this BPEL process  -->
  <!-- ================================================================= -->
  <bpel:variables>
    <bpel:variable name="clientRequest" messageType="ns:searchRequest"/>
    <bpel:variable name="clientResponse" messageType="ns:searchResponse"/>
    <bpel:variable name="helperRequest" messageType="ns:limitedSearchRequest"/>
  </bpel:variables>

  <!-- ================================================================= -->
  <!-- ORCHESTRATION LOGIC                                               -->
  <!-- Set of activities coordinating the flow of messages across the    -->
  <!-- services integrated within this business process                  -->
  <!-- ================================================================= -->
  <bpel:sequence name="main">

    <!-- Receive input from requester.
         Note: This maps to operation defined in BookSearch.wsdl -->
    <bpel:receive name="receiveInput" partnerLink="client"
                  portType="ns:bookSearchPort"
                  operation="search" createInstance="yes" variable="clientRequest"/>

    <!-- Generate reply to synchronous request -->
    <bpel:assign validate="no" name="prepareHelperQuery">
      <bpel:copy>
        <bpel:from>
          <bpel:literal xml:space="preserve"><ns:limitedSearch xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
            <keywords>
              <keyword></keyword>
            </keywords>
            <maxResults></maxResults>
          </ns:limitedSearch>
          </bpel:literal>
        </bpel:from>
        <bpel:to variable="helperRequest" part="parameters"></bpel:to>
      </bpel:copy>
      <bpel:copy>
        <bpel:from part="parameters" variable="clientRequest">
          <bpel:query>keywords</bpel:query>
        </bpel:from>
        <bpel:to part="parameters" variable="helperRequest">
          <bpel:query>keywords</bpel:query>
        </bpel:to>
      </bpel:copy>
      <bpel:copy>
        <bpel:from>10</bpel:from>
        <bpel:to part="parameters" variable="helperRequest">
          <bpel:query>maxResults</bpel:query>
        </bpel:to>
      </bpel:copy>
    </bpel:assign>
    <bpel:invoke name="askHelper" partnerLink="helper"
                 operation="search"
                 portType="ns:limitedBookSearchPort"
                 inputVariable="helperRequest"
                 outputVariable="clientResponse"/>
    <bpel:reply name="replyOutput"
                partnerLink="client"
                portType="ns:bookSearchPort"
                operation="search" variable="clientResponse"/>
  </bpel:sequence>
</bpel:process>
